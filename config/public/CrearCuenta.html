<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crear Cuenta - AutoConexion</title>
  <link rel="stylesheet" href="./css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Bootstrap 4 CSS -->
<link
rel="stylesheet"
href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
crossorigin="anonymous"
/>

<!-- jQuery para Bootstrap 4 -->
<script
src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
crossorigin="anonymous"
></script>

<!-- Popper.js para Bootstrap 4 -->
<script
src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
crossorigin="anonymous"
></script>

<!-- Bootstrap 4 JavaScript -->
<script
src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
crossorigin="anonymous"
></script>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* Estilos para la barra de navegación */
    .navbar {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        background-color: #f8f8f8;
    }

    /* Estilos para el logo */
    .logo {
        margin-right: 20px;
    }

    /* Estilos para el menú de navegación */
    .menu {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .menu li {
        margin: 0 15px;
    }

    .menu a {
        text-decoration: none;
        color: #333;
        padding: 10px 15px;
        transition: background-color 0.3s;
    }

    .menu a:hover {
        background-color: #ddd;
    }

    /* Estilos para el formulario */
    .signup-section {
        text-align: center;
        padding: 30px 20px;
    }

    .signup-form {
        display: inline-block;
        text-align: left;
        max-width: 400px;
        width: 100%;
        margin: 0 auto;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
    }

    .submit-button {
        width: 100%;
        padding: 10px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .submit-button:hover {
        background-color: #45a049;
    }

    .back-link, .login-link {
        color: #333;
        text-decoration: none;
        margin-top: 10px;
        display: block;
    }

    .back-link:hover, .login-link:hover {
        text-decoration: underline;
    }

    /* Estilos para el pie de página */
    .footer {
        text-align: center;
        padding: 20px;
        background-color: #f8f8f8;
    }

    /* Estilos responsivos */
    @media (max-width: 600px) {
        .navbar {
            flex-direction: column;
        }

        .menu {
            flex-direction: column;
        }

        .menu li {
            margin-bottom: 10px;
        }

        .signup-form {
            max-width: 90%;
        }
    }
  </style>
</head>
<body>

  <!-- Barra de navegación -->
  <header>
    <nav class="navbar">
      <div class="logo">
        <a href="./views/index.html">
          <img src="./imagenes/LOGO.png" alt="Logo">
        </a>
      </div>
      <ul class="menu">
        <!-- Lista de elementos del menú de navegación -->
        <li><a href="./AcercaDeNosotros.html">Acerca de Nosotros</a></li>
        <!-- Enlace a la página 'Acerca de Nosotros' -->
        <li><a href="./ConoceDeAutos.html">Conoce de Autos</a></li>
        <!-- Enlace a la página 'Autos Nuevos' -->
      </ul>
    </nav>
  </header>


<body>

<!-- Sección de crear cuenta -->
<br>
<section class="signup-section">
  <h2>Crear Cuenta</h2>
  <form method="post" class="signup-form">
    <div class="form-group">
      <label for="nombre">Nombre:</label>
      <input type="text" id="nombre" name="nombre" required placeholder="Introduce tu nombre" pattern="[A-Za-z\s]+" title="El nombre solo debe contener letras y espacios.">
      <span class="error-message">El nombre solo debe contener letras y espacios.</span>
    </div>
    <div class="form-group">
      <label for="apellido">Apellido:</label>
      <input type="text" id="apellido" name="apellido" required placeholder="Introduce tu apellido" pattern="[A-Za-z\s]+" title="El apellido solo debe contener letras y espacios.">
      <span class="error-message">El apellido solo debe contener letras y espacios.</span>
    </div>
    <div class="form-group">
      <label for="identificacion">Identificación:</label>
      <input type="text" id="identificacion" name="identificacion" required placeholder="Introduce tu identificación" pattern="[0-9]+" title="La identificación solo debe contener números.">
      <span class="error-message">La identificación solo debe contener números.</span>
    </div>
    <div class="form-group">
      <label for="email">Correo Electrónico:</label>
      <input type="email" id="email" name="email" required placeholder="ejemplo@correo.com">
    </div>
    <div class="form-group">
      <label for="contrasena">Contraseña:</label>
      <input type="password" id="contrasena" name="contrasena" required placeholder="Introduce una contraseña">
    </div>
    <div class="form-group">
      <label for="telefono">Teléfono:</label>
      <input type="tel" id="telefono" name="telefono" required placeholder="Introduce tu teléfono" pattern="[0-9]+" title="El teléfono solo debe contener números.">
      <span class="error-message">El teléfono solo debe contener números.</span>
    </div>
    <div class="form-group">
      <label for="direccion">Dirección:</label>
      <input type="text" id="direccion" name="direccion" required placeholder="Introduce tu dirección">
    </div>
    <div class="form-group">
      <label for="idCiudad">Ciudad:</label>
      <select id="idCiudad" name="idCiudad" required>
          <option value="">Selecciona una ciudad</option>
      </select>
    </div>
    <button type="button" class="btn btn-outline-success" style="width: 400px;" onclick="registrarUsuario()">Registrar</button>
  </form>
  <p><a href="./views/index.html" class="back-link">Volver a la página principal</a></p>
  <p>¿Ya tienes una cuenta? <a href="InicioSesion.html" class="back-link">Inicia sesión</a></p>
  
  <!-- Mensaje de error -->
  <div id="error-message" class="error-modal" style="display: none;">
    <p>No se pudo crear la cuenta. Verifica tus datos e inténtalo de nuevo.</p>
    <button type="button">Cerrar</button>
  </div>
  <!--Mensaje de exito-->
  <div id="success-message" class="error-modal" style="display: none;">
    <p>Usuario registrado con éxito, ya puedes iniciar sesion.</p>
    <button type="button" >Cerrar</button>
</div>
</section>


<!-- Pie de página -->
<footer class="footer">
  <div class="footer-content">
    <div class="footer-logo">
      <a href="./views/index.html">
        <img src="./imagenes/LOGO.png" alt="Logo">
      </a>
    </div>
    <div class="social-media">
      <a href="#"><i class="fab fa-facebook"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
    </div>
    <div class="business-hours">
      <p>Horarios de atención: Lunes a Viernes 9am - 6pm</p>
    </div>
  </div>
</footer>

<script src="javascript/env.js"></script>
<script>
  function registrarUsuario() {
    const usuario = {
      nombre: document.getElementById('nombre').value,
      apellido: document.getElementById('apellido').value,
      identificacion: document.getElementById('identificacion').value,
      contrasena: document.getElementById('contrasena').value,
      email: document.getElementById('email').value,
      direccion: document.getElementById('direccion').value,
      telefono: document.getElementById('telefono').value,
      idCiudad: document.getElementById('idCiudad').value
    };

    
   // Realizar la solicitud POST al servidor para registrar el usuario
  fetch(`${url}/usuarios`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(usuario)
    })
    .then(response => {
        if (response.ok) {
            // Si la respuesta es exitosa, mostrar el mensaje de éxito
            Swal.fire({
            icon:'success',
            text:'Usuario registrado con éxito, ya puedes iniciar sesión.'
            }).then(()=>{
              window.location.href =  'InicioSesion.html';
            })
        } else {
            // Si hay un error, mostrar el mensaje de error en el modal
            Swal.fire({
              icon:'error',
            text:'No se pudo crear la cuenta. Verifica tus datos e inténtalo de nuevo.'
            })
        }
    })
    .catch(error => {
        console.error('Error al registrar el usuario:', error);
        mostrarMensajeError(); // Mostrar el mensaje de error si hay un problema en la solicitud
    });
}

// Cargar las ciudades cuando se cargue la página
document.addEventListener('DOMContentLoaded', () => {
    fetch(`${url}/ciudades`)
        .then(response => response.json())
        .then(ciudades => {
            const selectCiudad = document.getElementById('idCiudad');
            ciudades.forEach(ciudad => {
                const option = document.createElement('option');
                option.value = ciudad.intIdCiudad; // El valor es el ID de la ciudad
                option.textContent = ciudad.strCiudad; // El texto visible es el nombre de la ciudad
                selectCiudad.appendChild(option);
            });
        })
        .catch(error => console.error('Error al cargar ciudades:', error));
});
</script>
</body>
</html>
